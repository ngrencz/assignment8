<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multisensory Math Worksheet Generator</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Andika&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #cbd5e1;
            --dot-color: #ef4444; 
            --ring-color: #3b82f6; 
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        /* --- Setup Menu --- */
        #setup-menu {
            max-width: 600px;
            margin: 0 auto 30px auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); font-size: 16px; box-sizing: border-box;
        }
        .checkbox-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .checkbox-label { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        button {
            width: 100%; padding: 15px; background: #1e293b; color: white; border: none; border-radius: 6px;
            font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.2s; margin-bottom: 10px;
        }
        button:hover { background: #334155; }
        .btn-print { background: #2563eb; }
        .btn-print:hover { background: #1d4ed8; }

        /* --- Worksheet Grid --- */
        #worksheet-container { display: none; max-width: 900px; margin: 0 auto; }
        #worksheet-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; margin-bottom: 30px; }
        .problem-cell { display: flex; align-items: flex-end; justify-content: flex-end; font-size: 55px; font-weight: bold; line-height: 1.1; position: relative; padding-bottom: 10px; border-bottom: 3px solid var(--text-color); }
        .op-sign { position: absolute; left: 0; bottom: 10px; }
        .num-stack { display: flex; flex-direction: column; align-items: flex-end; }
        
        /* Removed "Ans" placeholder visually, kept box for printing */
        .answer-box { width: 100%; height: 50px; border: 2px dashed var(--border-color); border-radius: 6px; margin-top: 10px; text-align: center; font-size: 24px; font-weight: bold; outline: none; }

        /* --- Touch Point CSS Engine --- */
        .touch-digit {
            position: relative;
            display: inline-block;
            width: 0.6em; 
            text-align: center;
            font-family: 'Andika', sans-serif !important; 
        }

        .dot { position: absolute; width: 9px; height: 9px; background-color: var(--dot-color); border-radius: 50%; z-index: 10; transform: translate(-50%, -50%); }
        .dot.double { background-color: white; border: 3px solid var(--ring-color); width: 7px; height: 7px; }
        .dot.double::after { content: ''; position: absolute; top: 50%; left: 50%; width: 5px; height: 5px; background-color: var(--dot-color); border-radius: 50%; transform: translate(-50%, -50%); }

        /* --- Dot Coordinates --- */
        .d1-1 { top: 20%; left: 50%; }
        
        .d2-1 { top: 25%; left: 20%; } 
        .d2-2 { top: 85%; left: 80%; } 
        
        /* 3: Lowered top dot to sit on the curve */
        .d3-1 { top: 22%; left: 25%; } 
        .d3-2 { top: 50%; left: 45%; } 
        .d3-3 { top: 85%; left: 25%; }
        
        /* 4: Top points and two elbow points */
        .d4-1 { top: 15%; left: 20%; } 
        .d4-2 { top: 15%; left: 80%; } 
        .d4-3 { top: 60%; left: 20%; } 
        .d4-4 { top: 60%; left: 80%; }
        
        .d5-1 { top: 20%; left: 20%; } 
        .d5-2 { top: 20%; left: 80%; } 
        .d5-3 { top: 50%; left: 20%; } 
        .d5-4 { top: 70%; left: 80%; } 
        .d5-5 { top: 90%; left: 35%; } 
        
        .d6-1 { top: 25%; left: 30%; } 
        .d6-2 { top: 50%; left: 25%; } 
        .d6-3 { top: 75%; left: 30%; }
        
        /* 7: Single top left (lowered), three doubles on spine */
        .d7-1 { top: 22%; left: 15%; } 
        .d7-2 { top: 35%; left: 45%; } 
        .d7-3 { top: 60%; left: 35%; }
        .d7-4 { top: 85%; left: 25%; }
        
        .d8-1 { top: 35%; left: 20%; } 
        .d8-2 { top: 35%; left: 80%; } 
        .d8-3 { top: 65%; left: 20%; } 
        .d8-4 { top: 65%; left: 80%; }
        
        /* 9: Three doubles on spine, one double top, one single bottom of bubble */
        .d9-1 { top: 40%; left: 75%; } 
        .d9-2 { top: 65%; left: 70%; } 
        .d9-3 { top: 90%; left: 60%; }
        .d9-4 { top: 15%; left: 50%; } 
        .d9-5 { top: 50%; left: 20%; }

        /* --- Print Rules --- */
        @media print {
            body { background: white; padding: 0; }
            #setup-menu, .print-hide { display: none !important; }
            #worksheet-container { display: block; max-width: 100%; margin: 0; }
            .answer-box { border: 1px solid black; } 
            .dot { background-color: black; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .dot.double { border-color: black; }
            .dot.double::after { background-color: black; }
        }
    </style>
</head>
<body>

<div id="setup-menu">
    <h1 style="margin-top:0; text-align:center;">TouchMath Generator</h1>
    <div class="form-group">
        <label>Number of Digits</label>
        <select id="setting-digits">
            <option value="1">1 Digit (e.g., 5)</option>
            <option value="2">2 Digits (e.g., 42)</option>
            <option value="3">3 Digits (e.g., 381)</option>
        </select>
    </div>
    <div class="form-group">
        <label>Operations (Select at least one)</label>
        <div class="checkbox-group">
            <label class="checkbox-label"><input type="checkbox" class="op-check" value="+" checked> Addition (+)</label>
            <label class="checkbox-label"><input type="checkbox" class="op-check" value="-"> Subtraction (-)</label>
            <label class="checkbox-label"><input type="checkbox" class="op-check" value="&times;"> Multiplication (&times;)</label>
            <label class="checkbox-label"><input type="checkbox" class="op-check" value="&divide;"> Division (&divide;)</label>
        </div>
    </div>
    <div class="form-group">
        <label>Number of Questions (Max 24)</label>
        <input type="number" id="setting-count" value="16" min="1" max="24">
    </div>
    <button onclick="generateWorksheet()">Generate Worksheet</button>
</div>

<div id="worksheet-container">
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px;">
        <h2>Name: ______________________</h2>
        <h2 style="margin-left: 20px;">Score: ____ / <span id="max-score-display">0</span></h2>
    </div>
    <div id="worksheet-grid"></div>
    <div class="print-hide" style="display:flex; gap: 15px; max-width: 500px; margin: 0 auto;">
        <button onclick="window.print()" class="btn-print">Print Worksheet</button>
        <button onclick="location.reload()" style="background: #64748b;">New Settings</button>
    </div>
</div>

<script>
    const touchHTML = {
        '0': `<span class="touch-digit">0</span>`,
        '1': `<span class="touch-digit">1<span class="dot d1-1"></span></span>`,
        '2': `<span class="touch-digit">2<span class="dot d2-1"></span><span class="dot d2-2"></span></span>`,
        '3': `<span class="touch-digit">3<span class="dot d3-1"></span><span class="dot d3-2"></span><span class="dot d3-3"></span></span>`,
        '4': `<span class="touch-digit">4<span class="dot d4-1"></span><span class="dot d4-2"></span><span class="dot d4-3"></span><span class="dot d4-4"></span></span>`,
        '5': `<span class="touch-digit">5<span class="dot d5-1"></span><span class="dot d5-2"></span><span class="dot d5-3"></span><span class="dot d5-4"></span><span class="dot d5-5"></span></span>`,
        '6': `<span class="touch-digit">6<span class="dot double d6-1"></span><span class="dot double d6-2"></span><span class="dot double d6-3"></span></span>`,
        '7': `<span class="touch-digit">7<span class="dot d7-1"></span><span class="dot double d7-2"></span><span class="dot double d7-3"></span><span class="dot double d7-4"></span></span>`, 
        '8': `<span class="touch-digit">8<span class="dot double d8-1"></span><span class="dot double d8-2"></span><span class="dot double d8-3"></span><span class="dot double d8-4"></span></span>`,
        '9': `<span class="touch-digit">9<span class="dot double d9-1"></span><span class="dot double d9-2"></span><span class="dot double d9-3"></span><span class="dot double d9-4"></span><span class="dot d9-5"></span></span>` 
    };

    function renderNumberWithDots(num) {
        let str = num.toString();
        let html = '';
        for (let i = 0; i < str.length; i++) {
            if (touchHTML[str[i]]) html += touchHTML[str[i]];
            else html += `<span class="touch-digit">${str[i]}</span>`;
        }
        return html;
    }

    function generateWorksheet() {
        const digits = parseInt(document.getElementById('setting-digits').value);
        let count = parseInt(document.getElementById('setting-count').value);
        if (count > 24) count = 24; 
        
        const opsChecked = document.querySelectorAll('.op-check:checked');
        if (opsChecked.length === 0) { 
            alert("Select operations."); 
            return; 
        }
        
        let ops = Array.from(opsChecked).map(cb => cb.value);
        const grid = document.getElementById('worksheet-grid');
        grid.innerHTML = '';
        document.getElementById('max-score-display').innerText = count;
        
        let maxVal = Math.pow(10, digits) - 1;
        let minVal = Math.pow(10, digits - 1);
        if (digits === 1) minVal = 1;

        for (let i = 0; i < count; i++) {
            let op = ops[Math.floor(Math.random() * ops.length)];
            let topNum, botNum;
            
            if (op === '+') { 
                topNum = rand(minVal, maxVal); 
                botNum = rand(minVal, maxVal); 
            } 
            else if (op === '-') { 
                topNum = rand(minVal, maxVal); 
                botNum = rand(minVal, maxVal); 
                if (botNum > topNum) { let t = topNum; topNum = botNum; botNum = t; } 
            }
            else if (op === '&times;') { 
                let mMax = digits === 1 ? 9 : (digits === 2 ? 15 : 40); 
                topNum = rand(1, mMax); 
                botNum = rand(1, 9); 
            }
            else if (op === '&divide;') { 
                let dFactor = rand(1, (digits === 1 ? 9 : 15)); 
                botNum = rand(1, 9); 
                topNum = dFactor * botNum; 
            }

            if (op === '&divide;') {
                grid.innerHTML += `
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div style="font-size: 40px; font-weight: bold; display: flex; align-items: center; gap: 10px;">
                            <div>${renderNumberWithDots(botNum)}</div>
                            <div style="border-left: 3px solid black; border-top: 3px solid black; padding-left: 10px; padding-top: 5px; min-width: 60px;">
                                ${renderNumberWithDots(topNum)}
                            </div>
                        </div>
                        <input type="text" class="answer-box print-hide">
                    </div>`;
            } else {
                grid.innerHTML += `
                    <div>
                        <div class="problem-cell">
                            <span class="op-sign">${op}</span>
                            <div class="num-stack">
                                <div>${renderNumberWithDots(topNum)}</div>
                                <div>${renderNumberWithDots(botNum)}</div>
                            </div>
                        </div>
                        <input type="text" class="answer-box print-hide">
                    </div>`;
            }
        }
        document.getElementById('setup-menu').style.display = 'none';
        document.getElementById('worksheet-container').style.display = 'block';
    }

    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
</script>

</body>
</html>
